[{"path":"https://boettiger-lab.github.io/earthdatalogin/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2023 earthdatalogin authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/articles/gdalcubes-stac-cog.html","id":"work-in-progress","dir":"Articles","previous_headings":"","what":"WORK IN PROGRESS","title":"Mosaic images using STAC","text":"High-resolution satellites generate many snapshot images limited field view spatial extent. order see larger area space, /observe changes across space time, need assemble many snapshots mosaic “data cube” can analyze cohesive whole. EARTHDATA STAC CATALOGS","code":"library(earthdatalogin) library(rstac) library(gdalcubes) gdalcubes_options(parallel = TRUE)"},{"path":"https://boettiger-lab.github.io/earthdatalogin/articles/gdalcubes-stac-cog.html","id":"earth-data-authentication","dir":"Articles","previous_headings":"WORK IN PROGRESS","what":"Earth Data Authentication","title":"Mosaic images using STAC","text":"First let’s get EDL authentication way. cloud data almost STAC catalog (NOAA, USGS, Planetary Computer, etc), authentication either unnecessary already provided STAC API, NASA EDL special. Remember set env vars EARTHDATA_USER EARTHDATA_PASSWORD .Renviron pass manually ed_set_token(). (gdalcubes package ’s mechanism setting GDAL config options independent environmental variables).","code":"header <- edl_set_token() #> Warning in edl_set_token(): GDAL VSI auth will require GDAL version >= 3.6. #>  but found only gdal version 3.4.1 gdalcubes_set_gdal_config(\"GDAL_HTTP_HEADERS\", header)"},{"path":"https://boettiger-lab.github.io/earthdatalogin/articles/gdalcubes-stac-cog.html","id":"search-via-stac","dir":"Articles","previous_headings":"","what":"Search via STAC","title":"Mosaic images using STAC","text":"now use rstac package search one NASA collections data falls desired bounding Set search box space & time Note 52 features matched search criteria! feature represents ‘snapshot’ image taken satellite passes (harmonized product actually ’s quite lot post-processing.) feature thus shares bounding box, projection, timestamp, may consist many different ‘assets’, different COG files representing different spectral bands satellite camera instrument. feature can potentially include quite extensive metadata feature, including details instrument post-processing, cloud cover. Unfortunately, EarthData’s STAC metadata tends quite sparse.","code":"bbox <- c(xmin=-122.5, ymin=37.5, xmax=-122.0, ymax=38)  start <- \"2022-01-01\" end <- \"2022-06-30\"  # Find all assets from the desired catalog: items <- stac(\"https://cmr.earthdata.nasa.gov/stac/LPCLOUD\") |>    stac_search(collections = \"HLSL30.v2.0\",               bbox = bbox,               datetime = paste(start,end, sep = \"/\")) |>   post_request() |>   items_fetch() |>   items_filter(filter_fn = \\(x) {x[[\"eo:cloud_cover\"]] < 20}) #>    |                                                                               |======================================================================| 100% #> Warning: In version 0.9.2, rstac changed how filter function is evaluated. In future versions, the `filter_fn` parameter will be evaluated against each feature in items instead of `properties` field. #> See ?items_filter for more details on how to change your function."},{"path":"https://boettiger-lab.github.io/earthdatalogin/articles/gdalcubes-stac-cog.html","id":"building-a-data-cube","dir":"Articles","previous_headings":"","what":"Building a Data Cube","title":"Mosaic images using STAC","text":"","code":"# Desired data cube shape & resolution v = cube_view(srs = \"EPSG:4326\",               extent = list(t0 = as.character(start),                              t1 = as.character(end),                             left = bbox[1], right = bbox[3],                             top = bbox[4], bottom = bbox[2]),               nx = 512, ny = 512, dt = \"P1M\") # RGB bands + cloud cover mask col <- stac_image_collection(items$features,                               asset_names = c(\"B02\", \"B03\", \"B04\", \"Fmask\")) #> Warning in stac_image_collection(items$features, asset_names = c(\"B02\", : STAC #> asset with name 'B02' does not include eo:bands metadata and will be considered #> as a single band source #> Warning in stac_image_collection(items$features, asset_names = c(\"B02\", : STAC #> asset with name 'B03' does not include eo:bands metadata and will be considered #> as a single band source #> Warning in stac_image_collection(items$features, asset_names = c(\"B02\", : STAC #> asset with name 'B04' does not include eo:bands metadata and will be considered #> as a single band source #> Warning in stac_image_collection(items$features, asset_names = c(\"B02\", : STAC #> asset with name 'Fmask' does not include eo:bands metadata and will be #> considered as a single band source # use a cloud mask -- not sure I have this correct # https://lpdaac.usgs.gov/documents/1326/HLS_User_Guide_V2.pdf S2.mask <- image_mask(\"Fmask\", values=1) # mask clouds and cloud shadows rgb_bands <- c(\"B04\",\"B03\", \"B02\")  # Here we go! note eval is lazy raster_cube(col, v, mask = S2.mask) |>   select_bands(rgb_bands) |>   plot(rgb=1:3) #> Warning in min(x): no non-missing arguments to min; returning Inf #> Warning in max(x): no non-missing arguments to max; returning -Inf #> Warning in min(x): no non-missing arguments to min; returning Inf #> Warning in max(x): no non-missing arguments to max; returning -Inf #> Warning in min(x): no non-missing arguments to min; returning Inf #> Warning in max(x): no non-missing arguments to max; returning -Inf"},{"path":[]},{"path":"https://boettiger-lab.github.io/earthdatalogin/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Carl Boettiger. Author, maintainer.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Boettiger C (2023). earthdatalogin: NASA EarthData Login Utilities. R package version 0.0.0.9000, https://boettiger-lab.github.io/earthdatalogin/.","code":"@Manual{,   title = {earthdatalogin: NASA EarthData Login Utilities},   author = {Carl Boettiger},   year = {2023},   note = {R package version 0.0.0.9000},   url = {https://boettiger-lab.github.io/earthdatalogin/}, }"},{"path":"https://boettiger-lab.github.io/earthdatalogin/index.html","id":"earthdatalogin-artificial_satellite-earth_asia","dir":"","previous_headings":"","what":"NASA EarthData Login Utilities","title":"NASA EarthData Login Utilities","text":"earthdatalogin seeks streamline process accessing NASA data Earth Data cloud program anywhere. Amazon Web Services (AWS) typically charges egress fees whenever network traffic leaves data center hosts , NASA restricted access data hosted Amazon accessible AWS servers running data center (us-west-2) using S3 access protocol. However, NASA also makes cloud data available publicly machine using standard HTTPS connection. cases require requesting managing credentials tied registered user name. package merely makes process easier. NASA EarthData also first introduction cloud-hosted data many researchers, fact NASA tries minimize egress charges restricting S3 access requests coming AWS us-west-2 compute center sometimes gives false impression accessing data “cloud” requires also paying Amazon Web Services compute time. entirely spurious. instance, NOAA also provides extensive set regularly updated data products AWS without restriction, can accessed standard HTTPS connection using S3 protocol anonymous user (keys tokens). maximize performance, heavy users NOAA data frequently choose access data AWS compute region (mostly us-east-1 NOAA), required. Technically speaking, frequently use vernacular phrase “accessing cloud data” refer network based access data using HTTP range requests – ability ask web server transfer range bytes individual file rather transferring entire file across network.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"NASA EarthData Login Utilities","text":"can install development version earthdatalogin GitHub :","code":"# install.packages(\"devtools\") devtools::install_github(\"boettiger-lab/earthdatalogin\")"},{"path":"https://boettiger-lab.github.io/earthdatalogin/index.html","id":"getting-started","dir":"","previous_headings":"","what":"Getting started","title":"NASA EarthData Login Utilities","text":"Access EarthData free, users required register. Please register note user name password take advantage package. good way keep track user name password set environmental variables using .Renviron file (see usethis::edit_r_environ()) record EARTHDATA_USER EARTHDATA_PASSWORD respectively. (kind access credentials, use unique password keep .Renviron file secure.) easiest universal method access using HTTP bearer token. Call edl_set_token() set token given username password (omit arguments read environmental variables): function takes care managing tokens . don’t tokens, request one minted. user name tokens already, look re-use . (EDL issue two tokens per user, tokens expire 6 month, users shouldn’t need worry since edl_set_token() handles ). function also set token GDAL environmental variable. means popular R packages terra, sf stars involve bindings GDAL automatically able utilize token operations reading HTTPS (using vsicurl prefix). PLEASE NOTE. requires GDAL >= 3.6.0 (see terra::gdal()). strongly recommend upgrading GDAL older version! Note can now successfully access file https machine internet connection, authentication steps. URL obtained variety ways, including https://search.earthdata.nasa.gov/search, searching individual DAACs, programmatically using EarthData STAC catalog. point despite barrier earthdatalogin, R code required cloud-native access now matches standard strategies use cloud-native access data source. defining feature makes ‘cloud native’ access fast access lazy. though individual files quite large, request downloaded entire file – instead used knowledge spatial data formats read just bytes file provide critical metadata extent, projection, bands coordinate ranges. Using information, can extract just bits data (locations, variables) care without download everything else well. saves RAM computer, drive space disks, well speeding download. Without techniques, processing massive amounts data coming modern earth observation methods impractical. However, data formats equally amenable approach. Requesting bytes file across hundreds miles network connection thing requesting bytes across six inches PCI connection processor hard-drive. recent formats like “Cloud Optimized Geotiff” (COG) files , name suggests, optimized . Complex older formats like HDF5 GRIB much less efficient. Network based range requests possible older (still widely used) formats, like HDF4. last case, need download file local disk (POSIX filesystem, hyperscale Object Store) read . Use edl_download() handle authenticated downloads case.","code":"library(earthdatalogin) edl_set_token() library(terra) #> terra 1.7.39 rast(\"https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T56JKT.2023246T235950.v2.0/HLS.L30.T56JKT.2023246T235950.v2.0.SAA.tif\",      vsi=TRUE) #> class       : SpatRaster  #> dimensions  : 3660, 3660, 1  (nrow, ncol, nlyr) #> resolution  : 30, 30  (x, y) #> extent      : 199980, 309780, 7190200, 7300000  (xmin, xmax, ymin, ymax) #> coord. ref. : WGS 84 / UTM zone 56N (EPSG:32656)  #> source      : HLS.L30.T56JKT.2023246T235950.v2.0.SAA.tif  #> name        : HLS.L30.T56JKT.2023246T235950.v2.0.SAA"},{"path":"https://boettiger-lab.github.io/earthdatalogin/index.html","id":"vignettes","dir":"","previous_headings":"","what":"Vignettes","title":"NASA EarthData Login Utilities","text":"facilitate cloud-native access NASA EarthData R, package also includes series vignettes illustrating use popular R packages (often less well-known) cloud-native modes. vignettes, take care leverage “lazy evaluation” avoid downloading . exception vignette S3 access within us-west-2, vignettes run anywhere, effective machines fast network access. Many university networks, cloud-hosted platform, GitHub Codespaces, offer excellent network performance purpose.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_as_s3.html","id":null,"dir":"Reference","previous_headings":"","what":"Replace https URLs with S3 URIs — edl_as_s3","title":"Replace https URLs with S3 URIs — edl_as_s3","text":"Replace https URLs S3 URIs","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_as_s3.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Replace https URLs with S3 URIs — edl_as_s3","text":"","code":"edl_as_s3(href, prefix = \"s3://\")"},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_as_s3.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Replace https URLs with S3 URIs — edl_as_s3","text":"href https URL EarthData Cloud address prefix preferred s3 prefix, e.g. s3:// (understood gdalcubes), /vsis3, terra/stars/sf GDAL-based interfaces.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_as_s3.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Replace https URLs with S3 URIs — edl_as_s3","text":"URI strips basename protocol appends prefix","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_as_s3.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Replace https URLs with S3 URIs — edl_as_s3","text":"","code":"href <- lpdacc_example_url() edl_as_s3(href) #> [1] \"s3://lp-prod-protected/HLSL30.020/HLS.L30.T56JKT.2023246T235950.v2.0/HLS.L30.T56JKT.2023246T235950.v2.0.SAA.tif\""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_download.html","id":null,"dir":"Reference","previous_headings":"","what":"download assets from earthdata over https using bearer tokens — edl_download","title":"download assets from earthdata over https using bearer tokens — edl_download","text":"NOTE: used primarily fallback mechanism! EarthData Cloud resources often best accessed directly HTTPS without download.  allows subsets extracted instead downloading unnecessary bits.  Unfortunately, certain formats support HTTP-based range requests (e.g. HDF4), require asset downloaded local POSIX filesystem first.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_download.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"download assets from earthdata over https using bearer tokens — edl_download","text":"","code":"edl_download(   href,   dest = basename(href),   header = edl_set_token(),   use_httr = TRUE,   ... )"},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_download.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"download assets from earthdata over https using bearer tokens — edl_download","text":"href https URL earthdata asset dest lcoal filepath destination header Authorization header (Bearer <token>).  requested automatically provided. use_httr logical, default TRUE. use httr base method? ... additional arguments utils::download.file() (ignored use_httr=TRUE).","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_download.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"download assets from earthdata over https using bearer tokens — edl_download","text":"dest path, invisibly","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_download.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"download assets from earthdata over https using bearer tokens — edl_download","text":"","code":"if (FALSE) { # interactive() href <- lpdacc_example_url() edl_download(href) }"},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_s3_token.html","id":null,"dir":"Reference","previous_headings":"","what":"Receive and set temporary AWS Tokens for S3 access — edl_s3_token","title":"Receive and set temporary AWS Tokens for S3 access — edl_s3_token","text":"Receive set temporary AWS Tokens S3 access","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_s3_token.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Receive and set temporary AWS Tokens for S3 access — edl_s3_token","text":"","code":"edl_s3_token(   daac = \"https://data.lpdaac.earthdatacloud.nasa.gov\",   username = Sys.getenv(\"EARTHDATA_USER\"),   password = Sys.getenv(\"EARTHDATA_PASSWORD\") )"},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_s3_token.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Receive and set temporary AWS Tokens for S3 access — edl_s3_token","text":"daac base URL DAAC username EarthDataLogin user password EarthDataLogin Password","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_s3_token.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Receive and set temporary AWS Tokens for S3 access — edl_s3_token","text":"list access key, secret key, session token expiration, invisibly.  Also sets corresponding AWS environmental variables.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_s3_token.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Receive and set temporary AWS Tokens for S3 access — edl_s3_token","text":"","code":"if (FALSE) { # interactive() edl_s3_token() }"},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_set_token.html","id":null,"dir":"Reference","previous_headings":"","what":"Get or set an earthdata login token — edl_set_token","title":"Get or set an earthdata login token — edl_set_token","text":"function ping EarthData API available tokens. token found, request one.  may two active tokens given time.  Use edl_revoke_token remove unwanted tokens.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_set_token.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get or set an earthdata login token — edl_set_token","text":"","code":"edl_set_token(   username = Sys.getenv(\"EARTHDATA_USER\"),   password = Sys.getenv(\"EARTHDATA_PASSWORD\"),   token_number = 1 )"},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_set_token.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get or set an earthdata login token — edl_set_token","text":"username EarthData Login User password EarthData Login Password token_number token (1 2)","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_set_token.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get or set an earthdata login token — edl_set_token","text":"Authorization header curl request, invisibly. also set GDAL_HTTP_HEADERS environmental variable compatibility GDAL.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_set_token.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Get or set an earthdata login token — edl_set_token","text":"NOTE: GDAL >= 3.6 required utilize GDAL_HTTP_HEADERS.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_set_token.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Get or set an earthdata login token — edl_set_token","text":"","code":"if (FALSE) { # interactive() edl_set_token() }"},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_stac_urls.html","id":null,"dir":"Reference","previous_headings":"","what":"Helper function for extracting URLs from STAC — edl_stac_urls","title":"Helper function for extracting URLs from STAC — edl_stac_urls","text":"Helper function extracting URLs STAC","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_stac_urls.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Helper function for extracting URLs from STAC — edl_stac_urls","text":"","code":"edl_stac_urls(items, assets = \"data\")"},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_stac_urls.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Helper function for extracting URLs from STAC — edl_stac_urls","text":"items items list rstac assets name(s) assets extract","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/edl_stac_urls.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Helper function for extracting URLs from STAC — edl_stac_urls","text":"vector hrefs discovered assets.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/lpdacc_example_url.html","id":null,"dir":"Reference","previous_headings":"","what":"URL for an example of an LP DAAC COG file — lpdacc_example_url","title":"URL for an example of an LP DAAC COG file — lpdacc_example_url","text":"URL example LP DAAC COG file","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/lpdacc_example_url.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"URL for an example of an LP DAAC COG file — lpdacc_example_url","text":"","code":"lpdacc_example_url()"},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/lpdacc_example_url.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"URL for an example of an LP DAAC COG file — lpdacc_example_url","text":"URL Cloud-Optimized Geotiff file LP DAAC.","code":""},{"path":"https://boettiger-lab.github.io/earthdatalogin/reference/lpdacc_example_url.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"URL for an example of an LP DAAC COG file — lpdacc_example_url","text":"","code":"lpdacc_example_url() #> [1] \"https://data.lpdaac.earthdatacloud.nasa.gov/lp-prod-protected/HLSL30.020/HLS.L30.T56JKT.2023246T235950.v2.0/HLS.L30.T56JKT.2023246T235950.v2.0.SAA.tif\""}]
